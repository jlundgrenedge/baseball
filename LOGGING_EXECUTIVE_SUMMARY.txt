================================================================================
BASEBALL SIMULATION LOGGING ARCHITECTURE - EXECUTIVE SUMMARY
================================================================================

Generated: 2025-11-19
Scope: Complete exploration of game_simulation.py, at_bat.py, play_outcome.py,
        and supporting logging infrastructure

================================================================================
KEY FINDINGS
================================================================================

1. MAIN LOGGING FILES IDENTIFIED:
   ✓ /home/user/baseball/batted_ball/game_simulation.py (985 lines)
   ✓ /home/user/baseball/batted_ball/at_bat.py (957 lines)
   ✓ /home/user/baseball/batted_ball/play_outcome.py (~86 lines)
   ✓ /home/user/baseball/batted_ball/sim_metrics.py (2402 lines)
   ✓ /home/user/baseball/batted_ball/fielding.py (1709 lines)
   ✓ /home/user/baseball/batted_ball/baserunning.py (1020 lines)

2. LOGGING ARCHITECTURE LAYERS:
   
   Layer 1 - GAME LEVEL (game_simulation.py, lines 205-857)
   ├─ GameSimulator class with verbose flag, log file, debug metrics
   ├─ log() method (line 252) - dual console+file output
   ├─ PlayByPlayEvent dataclass for structured logging
   └─ Current: Scores, stats, plays, descriptions
   
   Layer 2 - AT-BAT LEVEL (at_bat.py, lines 789-920)
   ├─ Pitch selection logic (line 230-312)
   ├─ Swing decision evaluation (line 835-841)
   ├─ Contact quality modeling (line 861-883)
   └─ Current: Pitch types, locations, contact outcomes
   
   Layer 3 - PLAY LEVEL (play_simulation.py + handlers)
   ├─ PlayResult with ordered events (PlayEvent objects)
   ├─ Fielding decisions and baserunning logic
   └─ Current: Event sequence, outcomes, runner positions
   
   Layer 4 - METRICS LEVEL (sim_metrics.py, 2402 lines)
   ├─ SimMetricsCollector (central aggregator)
   ├─ 7 detailed metrics dataclasses
   │  ├─ PitchMetrics (release, spin, trajectory, command)
   │  ├─ SwingDecisionMetrics (probabilities, timing, quality)
   │  ├─ BattedBallMetrics (physics, expected outcomes)
   │  ├─ FieldingMetrics (route efficiency, timing)
   │  ├─ BaserunningMetrics (speeds, timing, risk)
   │  ├─ PitcherFatigueMetrics (velocity/spin loss, command penalty)
   │  └─ ExpectedOutcomeMetrics (xBA, xwOBA, expected value)
   └─ Current: Not fully integrated, debug_metrics parameter controls output

3. VERBOSE MODE MECHANISM:
   └─ GameSimulator.__init__(verbose=True, log_file=None, debug_metrics=0)
      ├─ verbose: Controls console output (if/else around self.log() calls)
      ├─ log_file: Optional file path for dual output
      ├─ debug_metrics: Integer 0-3 controlling SimMetricsCollector detail
      └─ self.log() method writes to console AND file (line 252-258)

4. CURRENTLY LOGGED DATA:
   ✓ Pitch type and location (at line 828-832)
   ✓ Swing decision (yes/no at line 858-859)
   ✓ Pitch outcomes (called strike, ball, swinging strike, contact)
   ✓ Contact quality summary (basic at line 885-887)
   ✓ Play descriptions (implicit through PlayEvent objects)
   ✓ Final scores and statistics
   
5. AVAILABLE BUT NOT LOGGED:
   • Pitch intention (strike_looking vs competitive vs waste)
   • Contact offset from sweet spot (timing error, horizontal offset)
   • Swing probability before decision (decision rationale)
   • Fielder assignment logic (which fielder, why)
   • Ball landing position (explicit x, y, distance coordinates)
   • Runner advancement reasoning (time margin, risk assessment)
   • Expected vs actual outcomes (xDistance, xBA, xwOBA)
   • Pitcher fatigue effects per inning (velocity/spin loss)
   • Fielder route efficiency (straight-line vs actual path)
   • Model drift tracking (expected vs actual scoring patterns)

================================================================================
RESULT OBJECT STRUCTURES
================================================================================

PlayResult (play_outcome.py):
  - outcome: PlayOutcome enum (fly_out, single, double, home_run, error, etc.)
  - events: List[PlayEvent] (contact, catch, throw, runner_arrival, etc.)
  - runs_scored: int
  - outs_made: int
  - initial_runner_positions: Dict[str, Hitter]
  - final_runner_positions: Dict[str, Hitter]
  - batted_ball_result: BattedBallResult (trajectory physics)
  - play_description: str (human-readable summary)

AtBatResult (at_bat.py):
  - outcome: str ('strikeout', 'walk', 'in_play', 'foul')
  - pitches: List[Dict] (each has type, location, velocity, result)
  - final_count: Tuple[int, int] (balls, strikes)
  - batted_ball_result: Optional[Dict] (only if in_play)

GameState (game_simulation.py):
  - inning, outs, away_score, home_score
  - runner_on_first/second/third (Hitter objects)
  - Various team-specific stats (hits, HRs, Ks, BBs)
  - Lists: away_exit_velocities, away_launch_angles (for distribution)

PlayEvent (play_outcome.py):
  - time: float (seconds from contact)
  - event_type: str ('catch', 'throw', 'runner_arrival', etc.)
  - description: str (human-readable)
  - positions_involved: List[str] (fielders)

================================================================================
KEY DECISION POINTS & LOCATIONS
================================================================================

PITCH LEVEL:
  Pitch Selection:     at_bat.py, line 230-312, select_pitch_type()
                       → Uses arsenal, count leverage, sequencing
  
  Pitch Targeting:     at_bat.py, line 314-394, select_target_location()
                       → Returns target (h, v) in inches
  
  Pitch Intention:     at_bat.py, line 396-449, _determine_pitch_intention()
                       → Selects: strike_looking, competitive, waste, corner
  
  Swing Decision:      at_bat.py, line 835-841, hitter.decide_to_swing()
                       → Based on: location, count, velocity, discipline rating
  
  Contact Quality:     at_bat.py, line 861-883, simulate_contact()
                       → Returns: exit_velocity, launch_angle, contact_quality

FIELDING LEVEL:
  Fielder Assignment:  fielding.py, _assign_fielder_to_ball()
                       → Complex logic: distance, angle, error margin
  
  Route Efficiency:    fielding.py, simulate_fielder_movement()
                       → Straight-line vs actual path (not currently logged)
  
  Catch Attempt:       fly_ball_handler.py, attempt_trajectory_interception()
                       → Probability-based catch success

BASERUNNING LEVEL:
  Runner Advancement:  baserunning.py, advance_runner() or 
                       decide_runner_advancement()
                       → Based on: time margin, runner speed, risk assessment

HIT DETERMINATION:
  Hit Type:            hit_handler.py, line 40-80, determine_hit_type()
                       → Based on: distance, park fence, contact quality

================================================================================
RECOMMENDED LOGGING INSERTIONS (BY PRIORITY)
================================================================================

HIGHEST VALUE, LOWEST EFFORT (5-15 lines each):

1. Pitch Intention Logging
   File: at_bat.py, Function: _determine_pitch_intention() (line 396)
   Value: Shows pitcher strategy for each pitch
   Effort: 5 lines

2. Contact Quality Details
   File: at_bat.py, After: contact_summary dict (line 878)
   Value: Explains weak/fair/solid/barrel outcome
   Effort: 10 lines

3. Runner Advancement Reasoning
   File: baserunning.py, Function: advance_runner()
   Value: Shows why runners held or advanced
   Effort: 10 lines

4. Fielder Assignment Reasoning
   File: fielding.py, Function: _assign_fielder_to_ball()
   Value: Clarifies fielding decision-making
   Effort: 15 lines

MODERATE EFFORT, VERY HIGH VALUE (15-25 lines):

5. Ball Landing Position Details
   File: play_simulation.py, After: line 147-148
   Value: Complete fielding context
   Effort: 20 lines

6. Expected vs Actual Comparison
   File: game_simulation.py, Function: process_play_result() (line 492)
   Value: Model drift detection
   Effort: 15 lines

7. Pitcher Fatigue Tracking
   File: at_bat.py or game_simulation.py, Before: at-bat (line 323)
   Value: Pitcher performance context
   Effort: 25 lines

================================================================================
KEY INFRASTRUCTURE AVAILABLE
================================================================================

Logging Methods:
  ✓ self.log(message) - Dual console+file output (game_simulation.py, line 252)
  ✓ PlayEvent class - Structured event logging (play_outcome.py, line 28)
  ✓ SimMetricsCollector - Detailed metrics tracking (sim_metrics.py, line 1190)

Control Flags:
  ✓ self.verbose - Controls console logging
  ✓ self.log_handle - Controls file output
  ✓ self.metrics_collector - Controls detailed metrics output
  ✓ debug_metrics parameter (0-3) - Controls detail level

Best Practices:
  ✓ Check self.verbose before logging
  ✓ Use self.log() instead of print()
  ✓ Record to metrics_collector for detailed diagnostics
  ✓ Use PlayEvent for structured play logging
  ✓ Indentation: 2 spaces per level

================================================================================
DATA FLOW SUMMARY
================================================================================

   select_pitch_type()          at_bat.py (230)
              ↓
   select_target_location()     at_bat.py (314)
              ↓
   simulate_pitch()             at_bat.py (~600+)
              ↓
   decide_to_swing()            at_bat.py (835)
              ↓
   simulate_contact()           at_bat.py (861)
              ↓
   PlayResult.outcome           play_outcome.py
              ↓
   PlayResult.events[]          play_outcome.py (PlayEvent list)
              ↓
   process_play_result()        game_simulation.py (492)
              ↓
   log_play_by_play()           game_simulation.py (750)
              ↓
   metrics_collector            sim_metrics.py (2402 lines)
              ↓
   print_final_summary()        game_simulation.py (844)

================================================================================
DOCUMENTATION GENERATED
================================================================================

Two comprehensive analysis documents have been created:

1. LOGGING_ANALYSIS.md (19 KB, detailed)
   └─ Comprehensive 9-section analysis with all details
   └─ Located: /home/user/baseball/LOGGING_ANALYSIS.md

2. LOGGING_QUICK_REFERENCE.md (12 KB, actionable)
   └─ Quick lookup tables and insertion points
   └─ Located: /home/user/baseball/LOGGING_QUICK_REFERENCE.md

Both files are checked into the project root for easy access.

================================================================================
SUMMARY STATISTICS
================================================================================

Total Lines Analyzed:     ~8,500 lines of core code
Core Files:              9 files (game_simulation, at_bat, play_outcome,
                                  sim_metrics, fielding, baserunning, etc.)
Largest File:            sim_metrics.py (2,402 lines)
Current Logging Points:  ~40 explicit log locations
Available Data Points:   ~60 data points available but not logged
Recommended Additions:   7 high-value logging insertion points
Estimated Implementation: <100 lines total for all recommendations
Estimated Performance Impact: <3% overhead

================================================================================
